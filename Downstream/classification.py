from bert_serving.client import BertClient
bc = BertClient()
import numpy as np

#print(bc.encode(['6201', '320193']))


query = "320193"
#w = ['6201', '764622', '1800', '1122304', '2969', '773840', '4127', '4447', '4447', '4904', '4962', '4977', '5272', '1037868', '318154', '6281', '6769', '320193', '6951', '7084', '769397', '8670', '8818', '808362', '9389', '1390777', '9892', '10456', '10795', '732712', '1067983', '1067983', '764478', '12659', '314808', '12927', '315213', '14272', '14693', '14693', '1739940', '277948', '16732', '16918', '16918', '721371', '18230', '18926', '19617', '93410', '313927', '723254', '21076', '21344', '21665', '315293', '1166691', '28412', '831001', '356028', '23217', '1047862', '811156', '24545', '24545', '24545', '24545', '24741', '26172', '313616', '27419', '315189', '27904', '936340', '1744489', '29534', '715957', '29905', '1666700', '29989', '30554', '1326160', '1115222', '30625', '31791', '1551182', '31462', '32604', '33185', '33213', '746515', '34088', '37785', '753308', '1048911', '794367', '35527', '1281761', '36270', '36104', '36104', '1124198', '37996', '38777', '39899', '39911', '40533', '40545', '40704', '1467858', '1467858', '40987', '42582', '277135', '45012', '202058', '46080', '766704', '1637459', '46765', '47111', '47111', '47217', '354950', '48465', '1130310', '728535', '49196', '49826', '1466258', '50863', '51143', '51253', '51434', '51644', '52988', '200406', '833444', '319201', '1506307', '54480', '55067', '55785', '56873', '707549', '58492', '704051', '920760', '920760', '96223', '59478', '701985', '59558', '936468', '60086', '315852', '60667', '101778', '1070750', '62709', '62996', '63276', '63754', '63754', '63908', '64040', '927653', '1613103', '64803', '310158', '723125', '65984', '66740', '68505', '717423', '1623613', '70858', '70318', '814453', '1164727', '320187', '320187', '72207', '72333', '702165', '72741', '1111711', '72903', '73124', '1133421', '72971', '73309', '797468', '1031296', '1039684', '812074', '713676', '79879', '75362', '1004980', '1032208', '76334', '723531', '922224', '77360', '77476', '78003', '1109357', '764180', '1163165', '1163165', '78239', '78814', '80424', '788784', '822416', '1047122', '350698', '1024478', '745732', '85961', '754737', '87347', '1012100', '89800', '91419', '91440', '91576', '827052', '92122', '92380', '732717', '7332', '93556', '93751', '1393311', '310764', '1593538', '750556', '96021', '50104', '97476', '217346', '97745', '320335', '721683', '100493', '100493', '100517', '1002910', '100885', '731766', '1090727', '101829', '352915', '352915', '103379', '203527', '899689', '1396009', '104169', '1618921', '106040', '106535', '106640', '107263', '783325', '1770450', '109198', '109380', '92230', '773910', '895421', '1113169', '789019', '1341439', '791907', '793952', '796343', '798354', '5513', '1650107', '800459', '804753', '1308161', '1308161', '765880', '80661', '794323', '815097', '816284', '98246', '818479', '813828', '813828', '1555280', '316709', '815556', '820313', '1038357', '823768', '831259', '20286', '1090012', '920148', '1035002', '832988', '791519', '849399', '1551152', '1378946', '821189', '712515', '1564708', '1564708', '1567892', '858470', '1601712', '858877', '860730', '743988', '866787', '872589', '874761', '865752', '875159', '875320', '875045', '1633917', '879101', '1585364', '804328', '882095', '865436', '882835', '1105705', '851968', '1707925', '885725', '885639', '886158', '882184', '1532063', '829224', '891024', '1645590', '1646383', '895126', '1578845', '49071', '896878', '827054', '896159', '883569', '898173', '884887', '1451505', '899051', '354908', '906107', '908255', '1048286', '909832', '912615', '912750', '1063761', '915389', '916076', '916365', '914208', '1732845', '912242', '915912', '1045609', '920522', '922864', '726728', '927628', '935703', '1140859', '940944', '949039', '927066', '1000228', '1001250', '1000697', '1002047', '877890', '874766', '899866', '1020569', '1011006', '86312', '1015780', '861878', '1593034', '1593034', '1021860', '1022079', '1170010', '1018724', '1604778', '1037038', '1037540', '1040971', '1041061', '1043277', '1004434', '1067701', '1014473', '1050915', '1492633', '1053507', '740260', '1039101', '1058290', '1060391', '1051470', '1065088', '886982', '1045810', '1521332', '1075531', '1070412', '1275283', '1048695', '1043604', '1087423', '1364742', '1086222', '1324424', '1090872', '1099800', '1099219', '20520', '1013871', '1035267', '1110803', '1101239', '1059556', '1116132', '1110783', '1121788', '1103982', '1137774', '1467373', '1101215', '1140536', '1137411', '1136869', '1156039', '1156039', '1326380', '1126328', '1158449', '1065280', '1156375', '1174922', '1120193', '1168054', '1137789', '1267238', '1108524', '1141391', '1141391', '1652044', '1652044', '1285785', '1571949', '1324404', '1437107', '1437107', '1437107', '820027', '1336917', '1336917', '1339947', '1339947', '1058090', '1136893', '1326801', '1534701', '1361658', '1365135', '1359841', '1274494', '1373835', '1385157', '1393612', '816761', '1403161', '1403161', '1403161', '1413329', '1430602', '718877', '1442145', '1730168', '1452575', '1510295', '1524472', '1530721', '1526520', '1138118', '1489393', '1579241']
#words = list(set(w))

# 'words' corresponds to the S&P 500 companies on Feb 2019.
words = ['314808', '78239', '19617', '1035267', '704051', '914208', '1567892', '1087423', '1000697', '1137789', '707549', '920760', '1378946', '908255', '1039101', '1001250', '1070412', '87347', '728535', '899689', '1021860', '97745', '12659', '879101', '106535', '1578845', '58492', '10795', '875045', '740260', '1024478', '1163165', '12927', '750556', '808362', '315189', '764180', '788784', '899866', '310158', '1633917', '10456', '713676', '1666700', '1326801', '766704', '800459', '1274494', '732712', '769397', '1045609', '203527', '1571949', '886158', '6281', '865752', '92230', '1324424', '882835', '31462', '764622', '1065088', '812074', '77360', '1326380', '37785', '1645590', '1048695', '1041061', '1281761', '92122', '1015780', '277948', '49071', '36270', '72207', '816284', '51143', '1442145', '64803', '858877', '313616', '1613103', '47111', '1060391', '1022079', '822416', '1267238', '831001', '73124', '63908', '746515', '1070750', '27419', '14693', '20286', '827054', '935703', '721683', '882095', '1174922', '47217', '764478', '9389', '1014473', '4977', '1739940', '832988', '315852', '896159', '1099800', '89800', '1800', '1053507', '80661', '773910', '797468', '78814', '2969', '731766', '28412', '100493', '60667', '895126', '55067', '6951', '1489393', '1113169', '1099219', '1359841', '319201', '1116132', '36104', '1403161', '1140859', '851968', '4962', '1623613', '815097', '745732', '49826', '91440', '927653', '51434', '1050915', '97476', '773840', '1065280', '833444', '1105705', '1551152', '1285785', '31791', '866787', '107263', '93751', '821189', '1707925', '42582', '18926', '754737', '277135', '915389', '1308161', '1564708', '1324404', '50863', '109380', '1136893', '93410', '352915', '320335', '96021', '1437107', '1058090', '1396009', '93556', '1526520', '1101215', '1038357', '1156039', '49196', '1090872', '1555280', '1090727', '75362', '1108524', '85961', '55785', '1521332', '202058', '1058290', '1579241', '98246', '316709', '875320', '46080', '1467858', '1039684', '718877', '1530721', '811156', '896878', '796343', '4904', '865436', '14272', '106640', '1373835', '1130310', '26172', '1385157', '72333', '1652044', '79879', '96223', '885639', '1466258', '100885', '1032208', '1593034', '1067983', '354908', '885725', '109198', '886982', '63276', '27904', '922864', '5513', '59558', '51644', '54480', '1020569', '1110803', '1506307', '860730', '827052', '1013871', '4127', '38777', '1133421', '916076', '1510295', '40533', '66740', '1124198', '909832', '1770450', '715957', '816761', '920148', '1043604', '39911', '39899', '29905', '62709', '1339947', '350698', '1585364', '91419', '32604', '50104', '77476', '1141391', '927066', '1075531', '7332', '37996', '849399', '1452575', '46765', '1637459', '1341439', '72971', '24545', '794323', '813828', '29534', '80424', '1393612', '916365', '1593538', '791519', '33185', '717423', '895421', '936340', '920522', '875159', '40987', '1037540', '24741', '936468', '732717', '6201', '1451505', '723254', '104169', '743988', '1361658', '59478', '1467373', '1326160', '804328', '915912', '65984', '1744489', '912615', '1137411', '40545', '23217', '1109357', '310764', '315213', '1040971', '906107', '5272', '106040', '721371', '1037868', '701985', '318154', '18230', '1534701', '1090012', '92380', '101829', '200406', '861878', '68505', '1051470', '820027', '51253', '70318', '1047862', '1413329', '313927', '765880', '1018724', '7084', '1365135', '1004434', '820313', '1000228', '1045810', '100517', '315293', '9892', '1170010', '884887', '33213', '48465', '793952', '1121788', '927628', '52988', '4447', '64040', '753308', '1604778', '1551182', '1156375', '1002047', '1730168', '70858', '1126328', '891024', '789019', '726728', '1110783', '783325', '1601712', '1393311', '1011006', '1164727', '1646383', '1137774', '1035002', '723531', '16732', '1086222', '1140536', '21076', '794367', '1043277', '1031296', '1168054', '103379', '62996', '1002910', '72903', '912750', '63754', '1059556', '56873', '1364742', '21344', '21665', '1012100', '1063761', '949039', '73309', '60086', '1048286', '91576', '898173', '899051', '1336917', '702165', '712515', '858470', '791907', '1532063', '1275283', '40704', '1103982', '872589', '804753', '882184', '1101239', '1037038', '356028', '8670', '45012', '874761', '940944', '1650107', '8818', '1115222', '823768', '1048911', '1122304', '76334', '320193', '29989', '34088', '883569', '874766', '1158449', '30625', '1047122', '922224', '798354', '1618921', '320187', '72741', '1067701', '16918', '217346', '1166691', '1492633', '354950', '912242', '1430602', '815556', '1138118', '86312', '101778', '78003', '818479', '831259', '1524472', '6769', '1111711', '35527', '30554', '1120193', '723125', '1732845', '1390777', '1004980', '20520', '877890', '1136869', '814453', '829224']
d = []

for i in range(len(words)):
    r = []
    query = words[i]
    r.append(query)
    query_vec = bc.encode([query])[0]
    doc_vecs = bc.encode(words)
    score = np.sum(query_vec * doc_vecs, axis=1) / np.linalg.norm(doc_vecs, axis=1)

    # Top 10 related firms
    topk_idx = np.argsort(score)[::-1][1:11]

    for i in range(len(topk_idx)):
        r.append(words[topk_idx[i]])
        #print(words[topk_idx[i]])
    d.append(r)

df = pd.DataFrame(d)
df.columns = ["target","top1","top2","top3","top4","top5","top6","top7","top8","top9","top10"]
df.to_csv("top10firms.csv")